<?php

class Key {
	//Ceux-ci devront être fabriquer en fonction de la base de donnée.
	//faire un installer en php pour créer ses 2 clés ainsi que la DB.
	//sortir ses 2 clés et les placer dans le fichier 'config.php' car se fichier devra être créer mais aussi généré.
	private const keyAES    = '(G+KbPeShVmYq3t6v9y$B&E)H@McQfTjA%D*G-KaPdSgVkYp3s6v8y/B?E(H+MbQ7w!z%C*F-JaNdRgUkXp2s5v8x/A?D(G+q3t6w9z$C&F)J@NcRfUjXn2r5u7x!A%DVmYq3s6v9y$B&E)H@McQfTjWnZr4u7w!dSgVkYp3s5v8y/B?E(H+MbQeThWmZq4tJaNdRgUkXp2s5u8x/A?D(G+KbPeShVmY&F)J@NcRfUjXn2r4u7x!A%D*G-KaPdSgy$B&E)H@McQfTjWnZr4t7w!z%C*F-JaN5v8y/B?E(H+MbQeThWmZq4t6w9z$C&F)p2r5u8x/A?D(G+KbPeShVmYq3t6v9y$BUjXnZr4u7x!A%D*G-KaPdSgVkYp3s5v8cQfTjWnZq4t7w!z%C*F-JaNdRgUkXp2sH+MbQeThWmZq3t6w9z$C&F)J@NcRfUjX?D(G+KbPeShVmYq3s6v9y$B&E)H@McQfx!A%D*G-KaPdSgVkYp3s5v8y/B?E(H+M4t7w!z%C*F-JaNdRgUkXp2r5u8x/A?D(mYq3t6w9z$C&F)J@NcRfUjXn2r4u7x!AShVmYp3s6v9y$B&E)H@McQfTjWnZr4t7aPdSgVkYp2s5v8y/B?E(H+MbQeThWmZqF-JaNdRgUkXn2r5u8x/A?D(G+KbPeShV$C&F)J@NcRfUjXnZr4u7x!A%D*G-KaPdv9y$B&E)H@McQfTjWnZq4t7w!z%C*F-J2s5v8y/B?E(H+MbQeThWmZq3t6w9z$C&jXn2r5u8x/A?D(G+KbPeShVmYp3s6v9yRfUjWnZr4u7x!A%D*G-KaPdSgVkYp2s5@McQfTjWmZq4t7w!z%C*F-JaNdRgUkXpE(H+MbQeThWmYq3t6w9z$C&F)J@NcRfU/A?D(G+KbPeShVkYp3s6v9y$B&E)H@Mcu7x!A%D*G-KaPdSgVkXp2s5v8y/B?E(HZq4t7w!z%C*F-JaNdRgUkXn2r5u8x/A?hVmYq3t6w9z$C&F)J@NcRfUjXnZr4u7xPeShVkYp3s6v9y$B&E)H@McQfTjWnZq4-KaPdSgUkXp2s5v8y/B?E(H+MbQeThWmC*F-JaNdRgUjXn2r5u8x/A?D(G+KbPeS9z$C&F)J@NcRfUjWnZr4u7x!A%D*G-Kas6v9y$B&E)H@McQfTjWmZq4t7w!z%C*FXp2s5v8y/B?E(H+MbQeThVmYq3t6w9z$fUjXn2r5u8x/A?D(G+KbPeShVkYp3s6vNcRfTjWnZr4u7x!A%D*G-KaPdSgVkXp2)H@McQfThWmZq4t7w!z%C*F-JaNdRgUkB?E(H+MbQeShVmYq3t6w9z$C&F)J@NcR8x/A?D(G+KbPeSgVkYp3s6v9y$B&E)H@r4u7x!A%D*G-KaPdSgUkXp2s5v8y/B?EWmZq4t7w!z%C*F-JaNdRgUjXn2r5u8x/eShVmYq3t6w9z$C&F)J@NcRfUjWnZr4uKbPdSgVkYp3s6v9y$B&E)H@McQfThWmZ*G-KaPdRgUkXp2s5v8y/B?E(H+MbQeThz%C*F-JaNdRfUjXn2r5u8x/A?D(G+KbP6w9z$C&F)J@NcRfTjWnZr4u7x!A%D*G-p3s6v9y$B&E)H@McQeThWmZq4t7w!z%CUkXp2s5v8y/B?E(H+MbQeShVmYq3t6w9cRfUjXn2r5u8x/A?D(G+KbPeSgVkYp3sJ@NcQfTjWnZr4u7x!A%D*G-KaPdSgUkX&E)H@MbQeThWmZq4t7w!z%C*F-JaNdRfy/B?E(H+MbPeShVmYq3t6w9z$C&F)J@N5u8x/A?D(G+KbPdSgVkYp3s6v9y$B&E)nZr4u7x!A%D*G-KaPdRgUkXp2s5v8y/BThWmZq4t7w!z%C*F-JaNdRfUjXn2r5u8bPeShVmYq3t6w9z$C&F)J@NcQfTjWnZrG+KaPdSgVkYp3s6v9y$B&E)H@McQeThW%D*G-KaNdRgUkXp2s5v8y/B?E(H+MbQew!z%C*F-JaNcRfUjXn2r5u8x/A?D(G+K3t6w9z$C&F)J@McQfTjWnZr4u7x!A%D*kYp3s6v9y$B&E)H@MbQeThWmZq4t7w!zRgUkXp2s5v8y/B?E(H+MbPeShVmYq3t6@NcRfUjXn2r5u8x/A?D(G+KbPdSgVkYpF)H@McQfTjWnZr4u7x!A%D*G-KaNdRgU$B&E)H+MbQeThWmZq4t7w!z%C*F-JaNcv8y/B?E(H+KbPeShVmYq3t6w9z$C&F)J2r5u8x/A?D(G+KaPdSgVkYp3s6v9y$B&jWnZr4u7x!A%D*G-KaNdRgUkXp2s5v8yQeThWmZq4t7w!z%C*F-J@NcRfUjXn2r5+KbPeShVmYq3t6w9z$C&F)J@McQfTjWnD(G-KaPdSgVkYp3s6v9y$B&E)H@MbQeT!A%D*G-JaNdRgUkXp2s5v8y/B?E(H+Mbt7w!z%C*F)J@NcRfUjXn2r5u8x/A?D(GYq3t6w9z$C&F)H@McQfTjWnZr4u7x!A%gVkYp3s6v9y$B&E)H+MbQeThWmZq4t7wNdRgUkXp2s5v8y/B?E(H+KbPeShVmYq3)J@NcRfUjXn2r5u8x/A?D(G-KaPdSgVkC&E)H@McQfTjWnZr4u7x!A%D*G-JaNdR9y$B&E(H+MbQeThWmZq4t7w!z%C*F-J@s5v8y/B?E(G+KbPeShVmYq3t6w9z$C&FXn2r5u8x/A?D(G-KaPdSgVkYp3s6v9y$fTjWnZr4u7x!A%D*F-JaNdRgUkXp2s5vMbQeThWmZq4t7w!z%C*F)J@NcRfUjXn2(G+KbPeShVmYq3t6w9z$C&F)H@McQfTjA?D*G-KaPdSgVkYp3s6v9y$B&E)H+MbQ7x!A%C*F-JaNdRgUkXp2s5v8y/B?E(G+q4t7w!z%C&F)J@NcRfUjXn2r5u8x/A?DVmYq3t6w9z$C&E)H@McQfTjWnZr4u7x!dSgVkYp3s6v9y$B&E(H+MbQeThWmZq4tJaNdRgUkXp2s5v8y/B?D(G+KbPeShVmY&F)J@NcRfUjXn2r5u8x/A?D*G-KaPdSgz$B&E)H@McQfTjWnZr4u7x!A%D*F-JaN6v9y$B?E(H+MbQeThWmZq4t7w!z%C*F)p2s5v8y/A?D(G+KbPeShVmYq3t6w9z$CUjXn2r5u8x/A%D*G-KaPdSgVkYp3s6v9cQfTjWnZr4u7x!A%C*F-JaNdRgUkXp2s';
	private const vectorAES = 'cd#4b%ef$b$_c4[z';

	public static function encryptAES($plaintext, $keyAES = self::keyAES, $vector = self::vectorAES) {
		$method = "AES-256-CBC";
		$key = hash('sha256', $keyAES, true);
		$iv  = ($vector == false)? openssl_random_pseudo_bytes(16):$vector;
		$ciphertext = openssl_encrypt($plaintext, $method, $key, OPENSSL_RAW_DATA, $iv);
		$hash = hash_hmac('sha256', $ciphertext, $key, true);
		$based = base64_encode($iv . $hash . $ciphertext);
		return $based;
	}
	
	public static function decryptAES($ivHashCiphertext, $keyAES = self::keyAES) {
		$method = "AES-256-CBC";
		$unbased = base64_decode($ivHashCiphertext);
		$iv = substr($unbased, 0, 16);
		$hash = substr($unbased, 16, 32);
		$ciphertext = substr($unbased, 48);
		$key = hash('sha256', $keyAES, true);
		if (hash_hmac('sha256', $ciphertext, $key, true) !== $hash) return null;
		return openssl_decrypt($ciphertext, $method, $key, OPENSSL_RAW_DATA, $iv);
	}
}